Let $\{0, 1\}^*$ denote the set of finite-length binary words with letters $0$ and $1$.
Let $\epsilon$ denote the empty word.
For any pair $p \in \N^2$, let $p_1$ and $p_2$ be the integers for which $p = (p_1, p_2)$.

Define the function $f : \{0, 1\}^* \to \N^2$ recursively by $f(\epsilon) = (1, 7)$ and
\[ f(wa) = \begin{cases} (f(w)_2, 2 f(w)_1 + 3 f(w)_2), & a = 0, \\ (f(w)_2, 3 f(w)_1 + f(w)_2), & a = 1. \end{cases} \]
For any word $w \in \{0, 1\}^*$, let $\overline{w}$ denote the reversal of $w$.
Prove that $f(\overline{w})_2 = f(w)_2$ for any $w \in \{0, 1\}^*$.



\subsection*{Solution}

Official solution: \url{https://www.imo-official.org/problems/IMO2009SL.pdf}

We follow the official solution.
The main observation is that $7 = 2 \cdot 2 + 3 \cdot 1 = 3 \cdot 2 + 1 \cdot 1$.
More generally, we prove the following:

\begin{lemma}\label{2009c3-1}
Let $\Gamma$ be an arbitrary set of letters, and let $\Gamma^*$ denote the set of finite words with letters in $\Gamma$.
Consider pairs $(k_a, m_a) \in \N^2$ for each $a \in \Gamma$ and $X, Y, Z \in \N$ satisfying
\[ k_a X + m_a Y = Z \quad \forall a \in \Gamma. \tag{1}\label{2009c3-eq1} \]
Define the function $f : \Gamma^* \to \N^2$ by $f(\epsilon) = (Y, Z)$ for each $a \in \Gamma$ and
\[ f(wa) = (f(w)_2, k_a f(w)_1 + m_a f(w)_2) \quad \forall w \in \Gamma^*, a, b \in \Gamma. \]
Then $f(\overline{w})_2 = f(w)_2$ for all $w \in \Gamma^*$.
\end{lemma}
\begin{proof}
For any pair $p \in \N^2$, define the auxiliary function $g_p : \Gamma^* \to \N^2$ by $g_p(\epsilon) = p$ and
\[ g_p(wa) = (g_p(w)_2, k_a g_p(w)_1 + m_a g_p(w)_2) \quad \forall w \in \Gamma^*, a \in \Gamma. \]
Then $f = g_{Y, Z}$, and the goal is to show that $g_{Y, Z}(\overline{w})_2 = g(w)_2$ for all $w \in \Gamma^*$.
Note that $g$ is linear in $p$, and the following formula holds:
\[ g_p(aw) = g_{p_2, k_a p_1 + m_a p_2}(w). \]

Proceed by strong induction on $|w|$.
The base case $w = \epsilon$ is trivial, and the case $|w| = 1$ follows by~\eqref{2009c3-1}.
Now consider $w \in \Gamma^*$ and $a, b \in \Gamma$, and suppose that
\[ g_{Y, Z}(\overline{w})_2 = g_{Y, Z}(w)_2 \wedge g_{Y, Z}(a \overline{w})_2 = g_{Y, Z}(wa)_2. \]
Direct calculation and~\eqref{2009c3-eq1} yields
\begin{align*}
    g_{Y, Z}(ba \overline{w})_2
    &= g_{k_b X + m_b Y, k_b Y + m_b Z}(a \overline{w})_2 \\
    &= k_b g_{X, Y}(a \overline{w})_2 + m_b g_{Y, Z}(a \overline{w})_2 \\
    &= k_b g_{Y, Z}(\overline{w})_2 + m_b g_{Y, Z}(a \overline{w})_2 \\
    &= k_b g_{Y, Z}(w)_2 + m_b g_{Y, Z}(wa)_2 \\
    &= k_b g_{Y, Z}(wa)_1 + m_b g_{Y, Z}(wa)_2 \\
    &= g_{Y, Z}(wab)_2.
\end{align*}
Induction step is complete.
The lemma is proved.
\end{proof}

The original problem follows by setting $\Gamma = \{0, 1\}$, $(k_0, m_0) = (2, 3)$, $(k_1, m_1) = (3, 1)$, and $(X, Y, Z) = (2, 1, 7)$.
